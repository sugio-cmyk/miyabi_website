# 記事自動投稿ツール - 要求定義書

## 1. 概要

### 1.1 目的
記事原稿のテキストファイルを読み込み、WordPressへの投稿までを自動化するツールを開発する。

### 1.2 背景
現状のワークフローは以下の3ステップが手動：
1. 記事原稿 → JSON構造化（AIを使用）
2. JSON → ブロックHTML化（block_generator.py）
3. ブロックHTML → WordPress投稿（手動コピペ）

これを1コマンドで完結させたい。

---

## 2. 機能要件

### 2.1 必須機能（Must）

| ID | 機能 | 説明 |
|----|------|------|
| F-001 | 原稿ファイル読み込み | Markdownファイルから原稿と設定を読み込む |
| F-002 | AI構造化 | Gemini APIで原稿をJSON形式に構造化 |
| F-003 | ブロックHTML生成 | 既存のblock_generator.pyを利用してHTML化 |
| F-004 | WordPress投稿 | REST APIで下書き投稿を作成 |
| F-005 | 結果出力 | 投稿URL・ステータスをコンソールに出力 |

### 2.2 推奨機能（Should）

| ID | 機能 | 説明 |
|----|------|------|
| F-006 | カテゴリ・タグ設定 | 投稿時にカテゴリ/タグを自動設定 |
| F-007 | アイキャッチ画像 | 指定した画像をアイキャッチに設定 |
| F-008 | CTA自動追加 | 記事末尾にCTAブロックを自動挿入 |
| F-009 | 中間ファイル保存 | JSON/HTMLを保存して確認可能に |
| F-013 | **構造バリデーション** | **生成されたJSONの品質を自動チェック** |
| F-014 | **既存投稿の検出・更新** | **slug一致投稿があれば編集モードで更新** |
| F-015 | **投稿履歴管理** | **slug→post_idのマッピングを保存** |
| F-016 | **JSON修復ロジック** | **AI出力の軽微なJSONエラーを自動修復** |

### 2.3 任意機能（Could）

| ID | 機能 | 説明 |
|----|------|------|
| F-010 | ドライラン | 投稿せずにプレビューのみ |
| F-011 | バッチ処理 | 複数ファイルを一括処理 |
| F-012 | スケジュール投稿 | 公開日時を指定して予約投稿 |
| F-017 | **確認モード** | **JSON生成後に一時停止して確認→続行** |
| F-018 | **接続テスト** | **Gemini/WordPress APIの接続確認コマンド** |

---

## 3. 非機能要件

### 3.1 パフォーマンス

| 項目 | 要件 |
|------|------|
| 処理時間 | 1記事あたり30秒以内 |
| API呼び出し | 1記事につき1リクエスト |

### 3.2 セキュリティ

| 項目 | 要件 |
|------|------|
| 認証情報 | 環境変数または設定ファイルで管理 |
| 設定ファイル | .gitignoreに追加、リポジトリに含めない |

### 3.3 運用性

| 項目 | 要件 |
|------|------|
| ログ出力 | 各ステップの成功/失敗を出力 |
| エラーハンドリング | 失敗時は中間ファイルを保存して再開可能に |

---

## 4. 制約条件

| 項目 | 内容 |
|------|------|
| 言語 | Python 3.10+ |
| 外部API | Gemini API（Google AI Studio） |
| WordPress | REST API有効、Application Password使用 |
| コスト | 無料枠内で運用（月5記事程度を想定） |

---

## 5. 用語定義

| 用語 | 定義 |
|------|------|
| 原稿ファイル | 記事本文とメタ情報を含むMarkdownファイル |
| JSON構造化 | 原稿を見出し・段落・リスト等のブロックに分解した構造 |
| ブロックHTML | WordPress Gutenbergエディタ用のHTMLコメント形式 |
| 下書き投稿 | status=draftで作成されるWordPress投稿 |

---

## 6. 成功基準

1. 原稿ファイルを1コマンドで下書き投稿まで完了できる
2. 投稿後、WordPress管理画面で内容確認・公開ができる
3. エラー時に原因が特定でき、再実行で復旧できる
